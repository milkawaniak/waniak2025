---
title: "AMP_ex5"
author: "Milka Waniak"
date: "2025-10-27"
output: html_document
---

```{r setup, include=FALSE}
#load csv data
path <- "/Users/milka/Documents/GitHub/psyc 251/waniak2025/data/processed/pilot"
data <- read_csv(file.path(path, "data.csv"))
```

#create a graph, on the left firt person trails and on the right 3rdx person trails,futher, in each on the lft there should be positive prime and unpleasant prime on the irght. furtheer, left shuold give proportion of pleasant responses, whil right should guve proportion or unpleasant responses. On y axis P(aware) and should give the proportion. in other owrds: Influence awareness responses by AMP type (first-person vs.
third-party), prime type (positive vs. negative), and trial response
(pleasant vs. unpleasant; Experiment 5). The y-axis shows the proportion of aware responses, with the dashed line at 0.5 marking
equiprobability. The solid lines represent condition means

```{r graph, include=FALSE}

# Reshape data from wide to long format
data_long <- data %>%
  pivot_longer(
    cols = -participant_id,
    names_to = "variable",
    values_to = "value"
  ) %>%
  # Extract perspective, measure type, and trial number
  extract(variable, 
          into = c("perspective", "measure", "trial_num"), 
          regex = "(first_person|third_person)_(prime|choice|influenced)_(\\d+)",
          remove = FALSE) %>%
  # Pivot wider to get prime, choice, and influenced as separate columns
  pivot_wider(
    names_from = measure,
    values_from = value,
    id_cols = c(participant_id, perspective, trial_num)
  )

# Calculate proportions
summary_data <- data_long %>%
  mutate(
    perspective_label = ifelse(perspective == "first_person", "First-person AMP", "Third-party AMP"),
    prime_type = ifelse(prime == "pleasant", "Positive prime", "Negative prime"),
    response_type = case_when(
      choice == "pleasant" ~ "Pleasant",
      choice == "unpleasant" ~ "Unpleasant",
      TRUE ~ NA_character_
    ),
    aware = ifelse(influenced == "influenced", 1, 0)  # 1 = aware, 0 = not aware
  ) %>%
  group_by(perspective_label, prime_type, response_type) %>%
  summarise(
    prop_aware = mean(aware, na.rm = TRUE),
    n = n(),
    .groups = "drop"
  ) %>%
  filter(!is.na(response_type))

# Create the plot
plot <- ggplot(summary_data, aes(x = response_type, y = prop_aware, fill = response_type)) +
  geom_bar(stat = "identity", position = position_dodge(width = 0.9), width = 0.7) +
  geom_hline(yintercept = 0.5, linetype = "dashed", color = "black") +
  facet_grid(perspective_label ~ factor(prime_type, levels = c("Positive prime", "Negative prime"))) +
  labs(
    x = "Response",
    y = "P(aware)",
    title = "Awareness response by prime, response, and AMP type",
    subtitle = "Exp. 5"
  ) +
  theme_minimal() +
  theme(
    legend.position = "none",
    strip.text = element_text(size = 12, face = "bold"),
    axis.text.x = element_text(angle = 0, hjust = 0.5),
    panel.grid.major.x = element_blank(),
    panel.border = element_rect(color = "black", fill = NA, size = 1)
  ) +
  scale_y_continuous(limits = c(0, 1), breaks = seq(0, 1, 0.2)) +
  scale_fill_manual(values = c("Pleasant" = "pink", "Unpleasant" = "purple"))

print(plot)

# Save the plot
#ggsave(file.path('/Users/milka/Documents/GitHub/psyc 251/waniak2025/data/processed/pilot', "awareness_plot.png"), plot = plot, width = 10, height = 6, dpi = 300)

# Print summary data for verification
print(summary_data)
```







Both the first-person AMP, Pdiff(pleasant)
=
0.350
(median
=
0.353; SD
=
0.358), and the third-party AMP,
Pdiff(pleasant)
=
0.348 (median
=
0.389; SD
=
0.380), were
characterized by an overall AMP effect. This finding is theo-
retically inconsequential but is a precondition for meaningful
analyses of the awareness items. More importantly, the AMP
effect was indistinguishable across the two AMP versions,suggesting that any differences in awareness effects cannot
be accounted for by differences in AMP performance alone.
The first-person AMP was characterized by somewhat
lower overall influence awareness rates, P(aware)
=
0.477
(median
=
0.471; SD
=
0.342) than the third-party AMP,
P(aware)
=
0.566 (median
=
0.583; SD
=
0.250). On the first-
person AMP we replicated the congruency effect already
observed in Experiments 1–4. Specifically, participants were
more likely to report influence awareness following pleas-
ant, P(aware)
=
0.512, than unpleasant, P(aware)
=
0.395,
responses when primes were positive. Conversely, they were
more likely to report influence awareness following unpleas-
ant, P(aware)
=
0.594, than pleasant, P(aware)
=
0.272,
responses when primes were negative.
Crucially from a theoretical perspective, a similar con-
gruency effect emerged on the third-party AMP. Specifi-
cally, just as on the first-person AMP, participants were
more likely to report influence awareness following pleas-
ant, P(aware)
=
0.679, than unpleasant, P(aware)
=
0.345,
responses when primes were positive. Conversely, they were
more likely to report influence awareness following unpleas-
ant, P(aware)
=
0.676, than pleasant, P(aware)
=
0.325,
responses when primes were negative. Notably, the awareness
effect was larger and more symmetric across prime valences
on the third-party AMP than on the first-person AMP.
Accordingly, the best-fitting model with influence
awareness (aware vs. unaware) as the dependent variable
contained random intercepts for participants and primes,
as well as a Prime Type (positive vs. negative) × Response
3181
portion of aware responses, with the dashed line at 0.5 marking
equiprobability. The solid lines represent condition means
(pleasant vs. unpleasant) × AMP Type (first-person vs.
third-party) interaction as the fixed effect, χ2(3)
=
139.64,
p < 0.001. Overall, in line with the descriptive statistics
reported above, the best-fitting model suggests that the
congruency effect was present on both the first-person and
the third-party AMP, but stronger on the latter than on the
former. In planned comparisons, we found a significant
congruency effect following both positive primes, b
=
0.41,
z
=
5.05, p < 0.001, and negative primes, b
=
1.33, z
=
16.62,
p < 0.001, on the first-person AMP. Crucially, similar but
larger congruency effects were also obtained following
both positive primes, b
=
1.87, z
=
23.76, p < 0.001, and
negative primes, b
=
1.63, z
=
19.93, p < 0.001, on the third-
party AMP.
In a final preregistered analysis, we probed whether
reported rates of influence awareness on the first-person
and third-party AMPs were associated with each other. Such
a relationship would provide initial evidence for the idea
that influence awareness judgments for the self and third
parties operate based on a shared mechanism not merely at
the group level but even at the level of individual raters. In
line with this idea, we found a robust correlation between
the proportion of aware judgments for the self and the past
participant at the individual level, r
=
0.487, t(263)
=
9.04,
p < 0.001. In other words, participants who believed that
they themselves were often influenced by the primes tended
to believe that the past participant whose performance they
were asked to judge had also often been influenced by the
primes and vice versa. This association cannot be explained by any similarities in AMP effects across present and past
participants given successful random assignment, r
=
0.007,
t(263)
=
0.11, p
=
0.912, ­ BF01
=
6.94.


```{r original work, include=FALSE}
# Exp. 5 ------------------------------------------------------------------

exp5All <- read.csv(paste(citation, "Exp. 5.csv"))
exp5AllLong <- read.csv(paste(citation, "Exp. 5 Long-format AMP.csv"))

# Participant exclusions

nrow(exp5All)
table(exp5All$all_sameSelf, useNA = "always")
table(exp5All$complete_ampSelf, useNA = "always")
table(exp5All$all_sameThird, useNA = "always")
table(exp5All$complete_ampThird, useNA = "always")


exp5 <- exp5All[exp5All$all_sameSelf == 0 & exp5All$complete_ampSelf == 1 & exp5All$all_sameThird == 0 & exp5All$complete_ampThird == 1, ]
exp5long <- exp5AllLong[exp5AllLong$session_id %in% exp5$session_id, ]

# Demographics

orderedTable(exp5$citizenship)
prop.table(orderedTable(exp5$citizenship))
prop.table(table(exp5$citizenship %in% c("United States", "Canada",
                                         "United Kingdom", "Australia",
                                         "South Africa", "New Zealand", "Ireland")))


orderedTable(exp5$gender)
prop.table(orderedTable(exp5$gender))

mean(exp5$age, na.rm = TRUE)
sd(exp5$age, na.rm = TRUE)

# Descriptive statistics
mean(exp5$ampDiffSelf, na.rm = TRUE)
median(exp5$ampDiffSelf, na.rm = TRUE)
sd(exp5$ampDiffSelf, na.rm = TRUE)
table(exp5$ampDiffSelf > 0)
prop.table(table(exp5$ampDiffSelf > 0))
hist(exp5$ampDiffSelf, col = "white", main = "Distribution of AMP scores", 
     xlab = "First-person AMP score")

mean(exp5$shareAwareSelf, na.rm = TRUE)
median(exp5$shareAwareSelf, na.rm = TRUE)
sd(exp5$shareAwareSelf, na.rm = TRUE)
hist(exp5$shareAwareSelf, col = "white", main = "Distribution of awareness responses",
     xlab = "First-person awareness response")

mean(exp5$ampDiffThird, na.rm = TRUE)
median(exp5$ampDiffThird, na.rm = TRUE)
sd(exp5$ampDiffThird, na.rm = TRUE)
table(exp5$ampDiffThird > 0)
prop.table(table(exp5$ampDiffThird > 0))
hist(exp5$ampDiffThird, col = "white", main = "Distribution of AMP scores", 
     xlab = "Third-party AMP score")

mean(exp5$shareAwareThird, na.rm = TRUE)
median(exp5$shareAwareThird, na.rm = TRUE)
sd(exp5$shareAwareThird, na.rm = TRUE)
hist(exp5$shareAwareThird, col = "white", main = "Distribution of awareness responses",
     xlab = "Third-party awareness response")


tapply(exp5long$aware_response[exp5long$amp_target == "First person"],
       list(exp5long$block_name[exp5long$amp_target == "First person"],
            exp5long$trial_response[exp5long$amp_target == "First person"]), mean)
tapply(exp5long$aware_response[exp5long$amp_target == "Third party"],
       list(exp5long$block_name[exp5long$amp_target == "Third party"],
            exp5long$trial_response[exp5long$amp_target == "Third party"]), mean)

plot(exp5$shareAwareSelf, exp5$ampDiffSelf)
abline(lm(exp5$ampDiffSelf ~ exp5$shareAwareSelf), col = "red")
cor(exp5$shareAwareSelf, exp5$ampDiffSelf, use = "pairwise.complete.obs")

plot(exp5$shareAwareThird, exp5$ampDiffThird)
abline(lm(exp5$ampDiffThird ~ exp5$shareAwareThird), col = "red")
cor(exp5$shareAwareThird, exp5$ampDiffThird, use = "pairwise.complete.obs")

# Trial-level analysis

exp5long$aware_response_fact <- factor(exp5long$aware_response)
exp5long$trial_response_fact <- factor(exp5long$trial_response)

# (M1) Intercept only; random intercepts for participants
exp5Model1 <- glmer(aware_response_fact ~ 1 + (1 | session_id), family = "binomial", exp5long)

# (M2) Intercept only; random intercepts for participants and past participants
exp5Model2 <- glmer(aware_response_fact ~ 1 + (1 | session_id) + (1 | target_session_id), family = "binomial",
                    exp5long)
anova(exp5Model1, exp5Model2)

# (M3) Intercept only; random intercepts for participants and target stimuli
exp5Model3 <- glmer(aware_response_fact ~ 1 + (1 | session_id) + (1 | target),
                    family = "binomial", exp5long)
anova(exp5Model1, exp5Model3)

# (M4) Intercept only; random intercepts for participants and prime stimuli
exp5Model4 <- glmer(aware_response_fact ~ 1 + (1 | session_id) + (1 | prime),
                    family = "binomial", exp5long)
anova(exp5Model1, exp5Model4)

# (M5) Main effect for response; random intercepts for participants and prime stimuli
exp5Model5 <- glmer(aware_response_fact ~ trial_response_fact + (1 | session_id) + (1 | prime),
                    family = "binomial", exp5long)
anova(exp5Model4, exp5Model5)

# (M6) Main effect for response and prime type; random intercepts for participants and prime stimuli
exp5Model6 <- glmer(aware_response_fact ~ trial_response_fact + block_name + (1 | session_id) + (1 | prime),
                    family = "binomial", exp5long)
anova(exp5Model5, exp5Model6)

# (M7) Response × Prime Type interaction; random intercepts for participants and prime stimuli
exp5Model7 <- glmer(aware_response_fact ~ trial_response_fact * block_name + (1 | session_id) + (1 | prime),
                    family = "binomial", exp5long)
anova(exp5Model6, exp5Model7)

# (M8) Response × Prime Type interaction, main effect of AMP type; random intercepts for participants and prime stimuli
exp5Model8 <- glmer(aware_response_fact ~ trial_response_fact * block_name + amp_target +
                         (1 | session_id) + (1 | prime), family = "binomial", exp5long)
anova(exp5Model7, exp5Model8)

# (M9) Response × Prime Type × AMP Type interaction; random intercepts for participants and prime stimuli
exp5Model9 <- glmer(aware_response_fact ~ trial_response_fact * block_name * amp_target +
                         (1 | session_id) + (1 | prime), family = "binomial", exp5long)
anova(exp5Model8, exp5Model9)

emmeansFitExp5 <- emmeans(exp5Model9, ~ trial_response_fact | block_name * amp_target)
pairs(emmeansFitExp5, adjust = "none")

margMeansExp5 <- data.frame(emmeansFitExp5)
margMeansExp5 <- margMeansExp5[c(4, 2, 3, 1, 8, 6, 7, 5), ]
margMeansExp5$emmean <- log2prob(margMeansExp5$emmean)
margMeansExp5$asymp.LCL <- log2prob(margMeansExp5$asymp.LCL)
margMeansExp5$asymp.UCL <- log2prob(margMeansExp5$asymp.UCL)

# Refitting model 9 to all participants
exp5AllLong$aware_response_fact <- factor(exp5AllLong$aware_response)
exp5AllLong$trial_response_fact <- factor(exp5AllLong$trial_response)

exp5Model9all <- glmer(aware_response_fact ~ trial_response_fact * block_name * amp_target +
                         (1 | session_id) + (1 | prime), family = "binomial", exp5AllLong)
emmeansFitExp5all <- emmeans(exp5Model9all, ~ block_name | trial_response_fact * amp_target)
pairs(emmeansFitExp5all, adjust = "none")

# Refitting model 9 to participants from English-speaking countries
exp5Model9eng <- glmer(aware_response_fact ~ trial_response_fact * block_name * amp_target +
                         (1 | session_id) + (1 | prime),
                       family = "binomial", exp5long[exp5long$session_id %in% exp5$session_id[exp5$citizenship %in% engCount], ])
emmeansFitExp5eng <- emmeans(exp5Model9eng, ~ block_name | trial_response_fact * amp_target)
pairs(emmeansFitExp5eng, adjust = "none")


exp5sum <- with(exp5long, tapply(aware_response, list(session_id, block_name, trial_response, amp_target), mean))

pdf(paste0(citation, " Exp. 5.pdf"), width = 12)
beanplot(exp5sum[, , 2, 1][, "Positive"],
         exp5sum[, , 1, 1][, "Positive"],
         exp5sum[, , 2, 1][, "Negative"],
         exp5sum[, , 1, 1][, "Negative"],
         exp5sum[, , 2, 2][, "Positive"],
         exp5sum[, , 1, 2][, "Positive"],
         exp5sum[, , 2, 2][, "Negative"],
         exp5sum[, , 1, 2][, "Negative"],
         what = c(0, 1, 1, 0), beanlinewd = 1,
         cutmin = 0, cutmax = 1,
         col = list(rainbow(4, alpha = 0.30)[1], rainbow(4, alpha = 0.30)[4]),
         border = "black",
         main = "Awareness response by prime, response, and AMP type\nExp. 5",
         axes = FALSE, bw = 0.2, ylab = "P(aware)",
         ylim = c(0, 1.2), xlab = "Response")
abline(h = 0.5, lty = 3)
axis(1, at = 1:2, labels = c("Pleasant", "Unpleasant"))
axis(1, at = 3:4, labels = c("Pleasant", "Unpleasant"))
axis(1, at = 5:6, labels = c("Pleasant", "Unpleasant"))
axis(1, at = 7:8, labels = c("Pleasant", "Unpleasant"))
axis(2, at = seq(0, 1, by = 0.2))
abline(v = 4.5)
text(2.5, 1.2, "First-person AMP")
text(1.5, 1.1, "Positive prime")
text(3.5, 1.1, "Negative prime")
text(6.5, 1.2, "Third-party AMP")
text(5.5, 1.1, "Positive prime")
text(7.5, 1.1, "Negative prime")
dev.off()

# First-person and third-party awareness judgments
cor.test(exp5$shareAwareSelf, exp5$shareAwareThird)
cor.test(exp5$ampDiffSelf, exp5$ampDiffThird)

# Exploratory analyses

exp5$influence_own <- as.numeric(paste(exp5$influence_own))
hist(exp5$influence_own, col = "white")
mean(exp5$influence_own, na.rm = TRUE)
median(exp5$influence_own, na.rm = TRUE)
```
